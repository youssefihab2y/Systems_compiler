0000 0 START   0
0000 0 FIRST   STL     RETADR         .SAVE RETURN ADDRESS
0003 0 CLOOP   JSUB    RDREC          .READ INPUT RECORD
0006 0         LDA     LENGTH         .TEST FOR EOF (LENGTH = 0)
0009 0         COMP    #0
000C 0         JEQ     ENDFIL         .EXIT IF EOF FOUND
000F 0         JSUB    WRREC          .WRITE OUTPUT RECORD
0012 0         J       CLOOP          .LOOP
0015 0 ENDFIL  LDA     =C'EOF'        .INSERT END OF FILE MARKER
0018 0         STA     BUFFER
001B 0         LDA     #3             .SET LENGTH = 3
001E 0         STA     LENGTH
0021 0         JSUB    WRREC          .WRITE EOF
0024 0         J       @RETADR        .RETURN TO CALLER
0000 1         USE     CDATA
0000 1 RETADR  RESW    1
0003 1 LENGTH  RESW    1
0000 2         USE     CBLKS
0000 2 BUFFER  RESB    4096           .4096-BYTE BUFFER AREA
1000 2 BUFEND  EQU     *              .FIRST LOCATION AFTER BUFFER
1000 2 MAXLEN  EQU     BUFEND-BUFFER  .MAXIMUM RECORD LENGTH
0027 0         USE
0027 0 RDREC   CLEAR   X              .CLEAR LOOP COUNTER
0029 0         CLEAR   A              .CLEAR A TO ZERO
002B 0         CLEAR   S              .CLEAR S TO ZERO
002D 0         +LDT    #MAXLEN
0031 0 RLOOP   TD      INPUT          .TEST INPUT DEVICE
0034 0         JEQ     RLOOP          .LOOP UNTIL READY
0037 0         RD      INPUT          .READ CHARACTER INTO REGISTER A
003A 0         COMP    A,S            .TEST FOR END OF RECORD (X'00')
003D 0         JEQ     EXIT           .EXIT LOOP IF EOR
0040 0         STCH    BUFFER,X       .STORE CHARACTER IN BUFFER
0043 0         TIXR    T              .LOOP UNLESS MAX LENGTH
0045 0         JLT     RLOOP          .HAS BEEN REACHED
0048 0 EXIT    STX     LENGTH         .SAVE RECORD LENGTH
004B 0         RSUB                   .RETURN TO CALLER
0006 1         USE     CDATA
0006 1 INPUT   BYTE    X'F1'          .CODE FOR INPUT DEVICE
004E 0         USE
004E 0 WRREC   CLEAR   X              .CLEAR LOOP COUNTER
0050 0         LDT     LENGTH
0053 0 WLOOP   TD      =X'05'         .TEST OUTPUT DEVICE
0056 0         JEQ     WLOOP          .LOOP UNTIL READY
0059 0         LDCH    BUFFER,X       .GET CHARACTER FROM BUFFER
005C 0         WD      =X'05'         .WRITE CHARACTER
005F 0         TIXR    T              .LOOP UNTIL ALL CHARACTERS
0061 0         JLT     WLOOP          .HAVE BEEN WRITTEN
0064 0         RSUB                   .RETURN TO CALLER
0007 1         USE     CDATA
0007 1         LTORG
000A 1         END     FIRST